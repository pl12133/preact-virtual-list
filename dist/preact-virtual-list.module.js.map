{"version":3,"file":"preact-virtual-list.module.js","sources":["../src/index.js"],"sourcesContent":["import { createElement, Component } from 'preact';\n\nconst STYLE_INNER = 'position:relative; overflow:hidden; width:100%; min-height:100%;';\n\nconst STYLE_CONTENT = 'position:absolute; top:0; left:0; height:100%; width:100%; overflow:visible;';\n\n/** Virtual list, renders only visible items.\n *\t@param {Array<*>} data         List of data items\n *\t@param {Function} renderRow    Renders a single row\n *\t@param {Number} rowHeight      Static height of a row\n *\t@param {Number} overscanCount  Amount of rows to render above and below visible area of the list\n *\t@param {Boolean} [sync=false]  true forces synchronous rendering\n *\t@example\n *\t\t<VirtualList\n *\t\t\tdata={['a', 'b', 'c']}\n *\t\t\trenderRow={ row => <div>{row}</div> }\n *\t\t\trowHeight={22}\n *\t\t\tsync\n *\t\t/>\n */\nexport default class VirtualList extends Component {\n\tresize = () => {\n\t\tif (this.state.height!==this.base.offsetHeight) {\n\t\t\tthis.setState({ height: this.base.offsetHeight });\n\t\t}\n\t};\n\n\thandleScroll = (e) => {\n\t\tthis.setState({ offset: this.base.scrollTop });\n\t\tif (this.props.sync) this.forceUpdate();\n\n\t\tif (this.props.onScroll) {\n\t\t\tthis.props.onScroll(e);\n\t\t}\n\t};\n\n\tcomponentDidUpdate() {\n\t\tthis.resize();\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.resize();\n\t\taddEventListener('resize', this.resize);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tremoveEventListener('resize', this.resize);\n\t}\n\n\trender({ data, rowHeight, renderRow, overscanCount=10, sync, ...props }, { offset=0, height=0 }) {\n\t\t// first visible row index\n\t\tlet start = (offset / rowHeight)|0;\n\n\t\t// actual number of visible rows (without overscan)\n\t\tlet visibleRowCount = (height / rowHeight)|0;\n\n\t\t// Overscan: render blocks of rows modulo an overscan row count\n\t\t// This dramatically reduces DOM writes during scrolling\n\t\tif (overscanCount) {\n\t\t\tstart = Math.max(0, start - (start % overscanCount));\n\t\t\tvisibleRowCount += overscanCount;\n\t\t}\n\n\t\t// last visible + overscan row index\n\t\tlet end = start + 1 + visibleRowCount;\n\n\t\t// data slice currently in viewport plus overscan items\n\t\tlet selection = data.slice(start, end);\n\n\t\treturn (\n\t\t\t<div {...props} onScroll={this.handleScroll}>\n\t\t\t\t<div style={`${STYLE_INNER} height:${data.length*rowHeight}px;`}>\n\t\t\t\t\t<div style={`${STYLE_CONTENT} top:${start*rowHeight}px;`}>\n\t\t\t\t\t\t{ selection.map(renderRow) }\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n"],"names":["STYLE_INNER","STYLE_CONTENT","VirtualList","state","height","base","offsetHeight","setState","e","offset","scrollTop","props","sync","forceUpdate","onScroll","resize","addEventListener","removeEventListener","data","rowHeight","renderRow","overscanCount","start","visibleRowCount","Math","max","end","selection","slice","handleScroll","length","map","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,WAAW,GAAG,kEAApB;AAEA,IAAMC,aAAa,GAAG,8EAAtB;AAEA;;;;;;;;;;;;;;;IAcqBC;;;;;;;;;;;;;;;;6DACX,YAAM;AACd,UAAI,MAAKC,KAAL,CAAWC,MAAX,KAAoB,MAAKC,IAAL,CAAUC,YAAlC,EAAgD;AAC/C,cAAKC,QAAL,CAAc;AAAEH,UAAAA,MAAM,EAAE,MAAKC,IAAL,CAAUC;AAApB,SAAd;AACA;AACD;;mEAEc,UAACE,CAAD,EAAO;AACrB,YAAKD,QAAL,CAAc;AAAEE,QAAAA,MAAM,EAAE,MAAKJ,IAAL,CAAUK;AAApB,OAAd;;AACA,UAAI,MAAKC,KAAL,CAAWC,IAAf,EAAqB,MAAKC,WAAL;;AAErB,UAAI,MAAKF,KAAL,CAAWG,QAAf,EAAyB;AACxB,cAAKH,KAAL,CAAWG,QAAX,CAAoBN,CAApB;AACA;AACD;;;;;;;yCAEoB;AACpB,WAAKO,MAAL;AACA;;;wCAEmB;AACnB,WAAKA,MAAL;AACAC,MAAAA,gBAAgB,CAAC,QAAD,EAAW,KAAKD,MAAhB,CAAhB;AACA;;;2CAEsB;AACtBE,MAAAA,mBAAmB,CAAC,QAAD,EAAW,KAAKF,MAAhB,CAAnB;AACA;;;wCAEgG;AAAA,+BAAtBN,MAAsB;AAAA,UAAtBA,MAAsB,6BAAf,CAAe;AAAA,+BAAZL,MAAY;AAAA,UAAZA,MAAY,6BAAL,CAAK;;AAAA,UAAxFc,IAAwF,QAAxFA,IAAwF;AAAA,UAAlFC,SAAkF,QAAlFA,SAAkF;AAAA,UAAvEC,SAAuE,QAAvEA,SAAuE;AAAA,oCAA5DC,aAA4D;AAAA,UAA5DA,aAA4D,mCAA9C,EAA8C;AAAA,UAA1CT,IAA0C,QAA1CA,IAA0C;AAAA,UAAjCD,KAAiC;;AAChG;AACA,UAAIW,KAAK,GAAIb,MAAM,GAAGU,SAAV,GAAqB,CAAjC,CAFgG;;AAKhG,UAAII,eAAe,GAAInB,MAAM,GAAGe,SAAV,GAAqB,CAA3C,CALgG;AAQhG;;AACA,UAAIE,aAAJ,EAAmB;AAClBC,QAAAA,KAAK,GAAGE,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYH,KAAK,GAAIA,KAAK,GAAGD,aAA7B,CAAR;AACAE,QAAAA,eAAe,IAAIF,aAAnB;AACA,OAZ+F;;;AAehG,UAAIK,GAAG,GAAGJ,KAAK,GAAG,CAAR,GAAYC,eAAtB,CAfgG;;AAkBhG,UAAII,SAAS,GAAGT,IAAI,CAACU,KAAL,CAAWN,KAAX,EAAkBI,GAAlB,CAAhB;AAEA,aACC,kCAASf,KAAT;AAAgB,QAAA,QAAQ,EAAE,KAAKkB;AAA/B,UACC;AAAK,QAAA,KAAK,YAAK7B,WAAL,qBAA2BkB,IAAI,CAACY,MAAL,GAAYX,SAAvC;AAAV,SACC;AAAK,QAAA,KAAK,YAAKlB,aAAL,kBAA0BqB,KAAK,GAACH,SAAhC;AAAV,SACGQ,SAAS,CAACI,GAAV,CAAcX,SAAd,CADH,CADD,CADD,CADD;AASA;;;;EA1DuCY;;;;"}